!function(e){"use strict";var t={steps:["info","shipping","payment"],currentStep:"info",sameBilling:!0,sameShipping:!0,vfields:"input, textarea, select",vfieldsIgnore:".invoice-only, .skip-field",init:function(t){if("undefined"==typeof wc_checkout_params&&!rey.vars.elementor_edit_mode)return console.error("Page is not set as a Checkout page. Access WooCommerce Settings > Advanced, and make sure to set the Checkout page to this page."),!1;if(void 0===e.fn.block)return!1;this.page_selector=".rey-checkoutPage.--layout-custom",this.$page=e(this.page_selector,t),this.$form=e(".rey-checkoutPage-form",this.$page),this.$review=e(".rey-checkoutPage-review",this.$page),this.billingFirst=this.$page.hasClass("--bfirst"),this.shippingDisabled=!e('.__step[data-step="shipping"]',this.$page).length,this.supportsSteps="yes"===this.$page.attr("data-steps"),this.shippingDisabled&&(this.steps=["info","payment"]),this.params=JSON.parse(this.$page.attr("data-bto-custom")||"{}");var i=0;if(window.location.hash&&this.supportsSteps){var s=window.location.hash.replace("#",""),o=this.steps.indexOf(s);-1!==o&&0!==o&&this.validate_fields("info")&&(i=o)}this.go_to_step(i,!0,!0),this.update_crumbs(),this.activateS2(),this.update_form_reviews(),this.events(),this.sticky_review(),this.make_tooltips()},events:function(){var t=this;e(document).on("click",this.page_selector+' button[name="apply_coupon"]',(function(i){i.preventDefault(),t.apply_coupon(e(this))})),e(document).on("click",this.page_selector+" .__step .__step-fwd",(e=>{e.preventDefault(),"info"===e.currentTarget.closest(".__step").getAttribute("data-step")?this.validate_info_and_process():this.go_to_next_step()})),e(document).on("click",this.page_selector+' .__step .__step-back[href^="#"]',(function(e){e.preventDefault(),t.go_to_prev_step()})),e(document).on("click",this.page_selector+" .rey-checkoutPage-review-toggle",(function(t){t.preventDefault(),e(this).parent().toggleClass("--mob-active")})),e(document).on("click",this.page_selector+" .rey-checkoutPage-crumbs a",(function(i){var s=e(this).attr("data-step");"cart"!==s&&(i.preventDefault(),t.go_to_step(t.steps.indexOf(s)))})),e(document).on("click",this.page_selector+" .rey-formReview-action a",(function(i){i.preventDefault();var s=e(this).attr("data-target");"billing"!==s?t.go_to_step(t.steps.indexOf(s)):e(".rey-checkoutDetails-billing").slideToggle()})),e(document).on("change",this.page_selector+" .rey-checkoutChoose-item input[type='radio']",(function(i){var s="different"===e(this).val(),o=e(this).closest(".rey-checkoutChoose"),a=e(".woocommerce-billing-fields__field-wrapper",o);o.toggleClass("--active",s),t.sameBilling=!s,e('input[name="ship_to_different_address"]').val(s?1:0),s?(e('input:not(input[name="ship_to_different_address"]):not(#shipping_country), textarea, select',a).val(""),t.clone_targeted_shipping_fields("#shipping_country")):t.clone_shipping_fields()})),e(document).on("change",this.page_selector+" .woocommerce-shipping-methods input[type='radio']",(function(e){t.$page.addClass("--loading")})),e(document).on("change",this.page_selector+" input[name='ship_to_different_address']",(function(i){var s=e(this),o=e(".woocommerce-shipping-fields__field-wrapper",t.$page);s.prop("checked")?(t.sameShipping=!1,o.slideDown(),e('input:not(input[name="ship_to_different_address"]):not(#shipping_country), textarea, select:not(#shipping_country)',o).val(""),e("#shipping_state",o).trigger("change")):(t.sameShipping=!0,o.slideUp(250,(function(){t.clone_billing_fields()})))})),e(document.body).on("reycore/woocommerce/checkout/changed_step",(function(i){t.update_crumbs(),t.update_form_reviews(),t.clone_shipping_fields(),t.clone_billing_fields(),t.animate_top(),t.make_tooltips(),t.$review.removeClass("--mob-active"),e(".woocommerce-error, .woocommerce-message, .woocommerce-info",t.$page).remove()})),e(document.body).on("updated_checkout",(function(e,i){t.update_form_reviews(i),t.$page.removeClass("--loading")})),e(document).on("change",".__step[data-step='info'] .woocommerce-shipping-fields input, .__step[data-step='info'] .woocommerce-shipping-fields textarea, .__step[data-step='info'] .woocommerce-shipping-fields select",(function(i){void 0!==wc_checkout_params.prevent_cloning_shipping_fields&&wc_checkout_params.prevent_cloning_shipping_fields||wc_checkout_params.exclude_cloning_fields&&e(this).is(wc_checkout_params.exclude_cloning_fields)||t.clone_shipping_fields()})),e(document).on("change",".__step[data-step='info'] .woocommerce-billing-fields input, .__step[data-step='info'] .woocommerce-billing-fields textarea, .__step[data-step='info'] .woocommerce-billing-fields select",(function(e){t.clone_billing_fields()})),e(document.body).on("checkout_error",(function(e){t.refresh_events()})),e(window).bind("popstate",(function(e){if(window.location.hash&&t.supportsSteps){var i=window.location.hash.replace("#",""),s=t.steps.indexOf(i);-1!==s&&0!==s&&t.validate_fields("info")&&t.go_to_step(t.steps.indexOf(i),!0)}}))},refresh_events:function(){e(".woocommerce-error a[data-reymodal]").on("click",(function(t){var i=JSON.parse(e(this).attr("data-reymodal")||"{}");(!e.isEmptyObject(i)&&"undefined"!==i.content&&i.content&&(i.content=e(i.content)),"undefined"!=typeof ReyModal)&&new ReyModal({linkAttributeName:!1,catchFocus:!1,closeOnEsc:!0,backscroll:!0}).init().open(i)}))},animate_top:function(){e("html, body").animate({scrollTop:this.$page.offset().top-rey.vars.adminBar-25},"fast",(function(e){return--e*e*e+1}))},update_crumbs:function(){e(" .rey-checkoutPage-crumbs li").removeClass("--active"),e(" .rey-checkoutPage-crumbs a[data-step="+this.currentStep+"]").parent().addClass("--active")},update_form_reviews:function(t){var i=this;e(".rey-formReview-block").each((function(t,s){var o=e(s),a=e(".rey-formReview-content",o),n=a.attr("data-fill");if("email"===n){var r=e("#billing_email");r.length&&a.text(r.val())}else if("address_ship"===n){var c=[],l=["shipping_address_1","shipping_address_2","shipping_city","shipping_state","shipping_postcode","shipping_country"];if(i.params.custom_ship_to){var p=i.params.custom_ship_to.trim().split(",");p.length&&(l=l.concat(p))}e.each(l,(function(t,i){var s=e("#"+i);s.length&&c.push(s.val())})),a.text(c.filter(Boolean).join(", "))}else if("address_bill"===n){var d=[],h=["billing_address_1","billing_address_2","billing_city","billing_state","billing_postcode","billing_country"];if(i.params.custom_bill_to){var _=i.params.custom_bill_to.trim().split(",");_.length&&(h=h.concat(_))}e.each(h,(function(t,i){var s=e("#"+i);s.length&&d.push(s.val())})),a.text(d.filter(Boolean).join(", "))}else if("method"===n){var g=e("#shipping_method input[type='radio']:checked");if(g.length||(g=e("#shipping_method input[type='hidden']")),g.length){var u=g.next("label"),f=e(".__label",u);f.length&&(u=f),a.text(u.text())}}}))},validate_info_and_process:function(){if(this.validate_fields("info")){var e=document.querySelector(`${this.page_selector} .__step[data-step='info'] .woocommerce-shipping-fields, ${this.page_selector} .__step[data-step='info'] .woocommerce-billing-fields`);if(e){var t={shipping:e.classList.contains("woocommerce-shipping-fields"),fields:{}};e.querySelectorAll(".validate-required input, .validate-required textarea, .validate-required select").forEach((e=>{t.fields[e.getAttribute("name")]=e.value})),rey.ajax.request("custom_layout_process_data",{data:t,cb:t=>{if(t&&t.success)if(t.data&&t.data.error){if(t.data.error.message&&!t.data.error.field)return console.error(t.data.error.message);if(t.data.error.field){var i=e.querySelector(`#${t.data.error.field}_field`);i&&i.classList.add("woocommerce-invalid","woocommerce-invalid-required-field");var s=i.querySelector(".__invalid-error");s&&s.remove();var o=document.createElement("span");o.classList.add("__invalid-error"),o.textContent=t.data.error.message,i.append(o)}}else this.go_to_next_step();else console.error("Something went wrong.")}})}}},go_to_next_step:function(){this.go_to_step(this.steps.indexOf(this.currentStep)+1)},go_to_prev_step:function(){this.go_to_step(this.steps.indexOf(this.currentStep)-1,!0,!0)},go_to_step:function(t,i,s){if(this.supportsSteps){if(!s){var o=!0;if(this.validate_fields("info")||(o=!1),o&&this.billingFirst&&!this.sameShipping&&(this.validate_fields("shipping")||(o=!1)),!o)return}var a=e(".__step[data-step]").eq(t),n=this;if(this.currentStep=a.attr("data-step"),a.length){this.$page.attr("data-active-step",this.currentStep),this.$page.addClass("--loading");var r=function(){0===t&&e("#billing_email").trigger("focus"),n.$page.removeClass("--loading"),a.show(),a.siblings(".__step").hide()};i?r():setTimeout(r,1200),window.location.hash=this.currentStep,e(document.body).trigger("reycore/woocommerce/checkout/changed_step",[a])}}},validate_fields:function(t){var i={},s=".__step[data-step='"+t+"'] .validate-required",o=document.querySelectorAll(s),a=e(s);e(".__invalid-error",this.$page).remove();for(var n=0;n<a.length;n++){var r=a[n],c=e(this.vfields,r);if(c.length&&0===c.closest(this.vfieldsIgnore).length&&"none"!==getComputedStyle(r).display){var l=c.val();if(""==l||"email"===c.attr("type")&&!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,})+$/.test(l)||"tel"===c.attr("type")&&!/^[\+\d\-\(\)\s]+$/.test(l)){var p=!0;e("input#createaccount").prop("checked")||c.closest(".create-account").length&&(p=!1),p&&(i[r.getAttribute("id")]=r)}if(a.length-1===n)return i=rey.hooks.applyFilters("checkout/validate_fields_issues",i,o),Object.keys(i).forEach(((t,s)=>{var o=e(i[t]);(o.addClass("woocommerce-invalid-required-field woocommerce-invalid"),e('<span class="__invalid-error">'+(i[t].getAttribute("data-error-text")||reyParams.checkout.error_text)+"</span>").insertAfter(e(".woocommerce-input-wrapper",i[t])),0===s)&&(o.offset().top&&window.scrollTo({top:o.offset().top-20,behavior:"smooth"}))})),!Object.keys(i).length}}},clone_billing_fields:function(){if(!this.shippingDisabled&&this.billingFirst&&this.sameShipping){var t=e(".woocommerce-shipping-fields"),i=e(".woocommerce-billing-fields");e(this.vfields,i).each((function(i,s){var o=e(s),a=o.val(),n=o.attr("name"),r=n.replace("billing_","shipping_"),c=e('[name="'+r+'"]',t);if(c.length)c.val(a).trigger("change");else{var l=e('[name="'+n+'"]',t);l.length&&l.val(a)}}))}},clone_shipping_fields:function(){this.sameBilling&&this.clone_targeted_shipping_fields(this.vfields)},clone_targeted_shipping_fields:function(t){if(!this.shippingDisabled&&!this.billingFirst){var i=e(".woocommerce-shipping-fields"),s=e(".woocommerce-billing-fields");e(t,i).each((function(t,i){var o=e(i),a=o.val(),n=o.attr("name").replace("shipping_","billing_"),r=e('[name="'+n+'"]',s);r.length&&r.val(a).trigger("change")}))}},apply_coupon:function(t){this.$review.is(".--loading")||this.$review.parents(".--loading").length||this.$review.addClass("--loading");var i=this,s=t.siblings("input[name='coupon_code']"),o=s.val(),a={security:wc_checkout_params.apply_coupon_nonce,coupon_code:o};e.ajax({type:"POST",url:wc_checkout_params.wc_ajax_url.toString().replace("%%endpoint%%","apply_coupon"),data:a,dataType:"html",success:function(s){e(".woocommerce-error, .woocommerce-message, .woocommerce-info",this.$page).remove(),e(".__notice",this.$page).remove();var o=e('<div class="__notice --clean-wc-notice">'+s+"</div>").insertAfter(t.parent());e(document.body).trigger("applied_coupon_in_checkout",[a.coupon_code]),e(document.body).trigger("update_checkout",{update_shipping_method:!1}),e(".woocommerce-message",o).length&&i.$review.addClass("--mob-active")},complete:function(){i.$review.removeClass("--loading"),s.val("")}})},sticky_review:function(){rey.vars.is_desktop&&this.$page.is(".--sticky-review")&&rey.elements.siteWrapper&&rey.elements.siteWrapper.style.setProperty("--site-wrapper-overflow","visible")},activateS2:function(){void 0!==e.fn.selectWoo&&e("select:not(.select2-hidden-accessible)",this.$form).each((function(){if(!this.classList.contains("--no-select2")&&!this.closest(".--no-select2")){var t={placeholder:e(this).attr("data-placeholder")||e(this).attr("placeholder")||"",width:"100%",containerCssClass:"select2-reyStyles",dropdownCssClass:"select2-reyStyles"};e(this).on("select2:select",(function(){e(this).focus()})).selectWoo(t)}}))},make_tooltips:function(){e(".woocommerce-shipping-fields .woocommerce-input-wrapper span.description, .woocommerce-billing-fields .woocommerce-input-wrapper span.description").each((function(t,i){var s=e(i),o=s.html();if(rey){var a=rey.frontend.svgIcon.get("help");e('<span class="rey-inputTip" data-rey-tooltip="'+o+'" data-tooltip-size="180">'+a+"</span>").insertAfter(s)}s.remove()}))}};rey.hooks.addAction("elementor/init",(function(e){e.registerElement({name:"reycore-wc-checkout.default",cb:function(e){t.init(e)}})}))}(jQuery);